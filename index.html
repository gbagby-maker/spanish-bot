<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profe Bot - Spanish Tutor</title>
    <style>
        :root { --primary: #e74c3c; --secondary: #2c3e50; --bg: #f9f9f9; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #chat-container { width: 100%; max-width: 500px; height: 90vh; background: white; box-shadow: 0 8px 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; border-radius: 15px; overflow: hidden; }
        #header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        #header h1 { margin: 0; font-size: 1.2rem; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg { padding: 12px 16px; border-radius: 15px; font-size: 15px; line-height: 1.5; max-width: 80%; }
        .bot { background: #f0f2f5; color: #333; align-self: flex-start; border-bottom-left-radius: 2px; }
        .user { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        #controls { padding: 20px; border-top: 1px solid #eee; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        #micBtn { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 50px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; transition: all 0.2s; }
        #micBtn:active { transform: scale(0.95); }
        #micBtn.listening { background: #27ae60; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        #status { font-size: 12px; color: #7f8c8d; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="header">
        <h1>ðŸ‡ªðŸ‡¸ Profe Bot: Spanish Tutor</h1>
    </div>
    <div id="chat-box" id="chatBox">
        <div class="msg bot">Â¡Hola! I can help you learn Spanish. Ask me "How do I say [word]?" or just say "Hola" to start a conversation!</div>
    </div>
    <div id="controls">
        <button id="micBtn">ðŸŽ¤ Click to Speak</button>
        <div id="status">Microphone: Standby</div>
    </div>
</div>

<script>
    const micBtn = document.getElementById('micBtn');
    const status = document.getElementById('status');
    const chatBox = document.getElementById('chat-box');

    // Speech Configuration
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = (SpeechRecognition) ? new SpeechRecognition() : null;
    const synth = window.speechSynthesis;

    if (recognition) {
        recognition.continuous = false;
        recognition.interimResults = false;
        // The bot listens for both English and Spanish, but we'll default to Spanish detection
        recognition.lang = 'es-ES'; 
    }

    function addMessage(text, sender) {
        const div = document.createElement('div');
        div.className = `msg ${sender}`;
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function speak(text, isSpanish = true) {
        synth.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = isSpanish ? 'es-ES' : 'en-US';
        utter.rate = 0.9; 
        synth.speak(utter);
    }

    function handleLogic(input) {
        const text = input.toLowerCase();
        let response = "";
        let langResponse = "es";

        // TEACHER MODE: If they ask "How do I say..."
        if (text.includes("how do you say") || text.includes("how do i say")) {
            const word = text.split("say ").pop();
            response = `To say "${word}" in Spanish, we usually use the word... [Translation Logic Here]. It is used in sentences like: "Me gusta ${word}".`;
            langResponse = "en"; // Explain in English
        } 
        // CONVERSATION MODE: Greetings
        else if (text.includes("hola") || text.includes("buenos dÃ­as")) {
            response = "Â¡Hola! Â¿CÃ³mo estÃ¡s? Â¿EstÃ¡s listo para practicar hoy?";
        }
        else if (text.includes("estoy bien") || text.includes("bien")) {
            response = "Â¡QuÃ© bueno! CuÃ©ntame, Â¿quÃ© planes tienes para este fin de semana?";
        }
        else {
            response = "Â¡Muy bien dicho! Sigue practicando. Â¿Tienes alguna otra pregunta sobre el vocabulario?";
        }

        addMessage(response, 'bot');
        speak(response, langResponse === "es");
    }

    micBtn.onclick = () => {
        if (!recognition) {
            alert("Your browser does not support speech recognition. Please use Chrome.");
            return;
        }
        recognition.start();
        micBtn.classList.add('listening');
        micBtn.innerText = "ðŸ›‘ Listening...";
        status.innerText = "Microphone: ACTIVE";
    };

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        addMessage(transcript, 'user');
        handleLogic(transcript);
    };

    recognition.onend = () => {
        micBtn.classList.remove('listening');
        micBtn.innerText = "ðŸŽ¤ Click to Speak";
        status.innerText = "Microphone: Standby";
    };

    recognition.onerror = (err) => {
        console.error(err);
        status.innerText = "Error: " + err.error;
    };
</script>

</body>
</html>
